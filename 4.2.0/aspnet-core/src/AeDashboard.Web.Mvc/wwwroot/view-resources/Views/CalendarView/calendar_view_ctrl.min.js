(function(){"use strict";function n(n,t,i,r,u,f,e,o,s){function v(){y();i.load=0;localStorage.removeItem("count");k();var n=(new Date).getFullYear()+"-W"+f.getWeek(new Date);i.week=moment(n).toDate();p();b("1")}function y(){$("[value=Create]").disabled=!0;$("[value=Save]").disabled=!0;h.on("ReceiveMessage",function(n,t,i){console.log("ok "+n+"  "+t+" "+i)});h.start().then(function(){$("[value=Create]").disabled=!1;$("[value=Save]").disabled=!1}).catch(function(n){return console.error(n.toString())});$("[value=Create]").on("click",function(){h.invoke("SendMessage","1","table","create").catch(function(n){return console.error(n.toString())})})}function p(){t.get("/Document/GetIsAdmin").then(function(n){i.getIsAdmin=n.data.result})}function w(n){var i="/Calendar/EditCalendarViewModal1?id="+n;t.get(i).then(function(n){$(".name-admin1").trigger("set",{id:n.data.result.idAdmins});$(".name-admin2").trigger("set",{id:n.data.result.idUsers});console.log(n.data.result.idUsers);console.log(n.data.result.idAdmins)})}function b(n){var r="/Calendar/GetUsers?ids="+n;t.get(r).then(function(n){i.users=n.data.result})}function k(){$(window).scroll(function(){var n=$(document).height()-$(window).height()-$(window).scrollTop(),t=!1;n>=0&&n<=9&&(t=!0);n>=400&&n<=410&&(t=!0);n>=300&&n<=310&&(t=!0);n>=50&&n<=60&&(t=!0);n>=100&&n<=110&&(t=!0);n>=150&&n<=160&&(t=!0);n>=200&&n<=210&&(t=!0);t&&(i.count=i.count+1,l(i.count,i.search),f.getColor())})}function d(n,r,u){var e={Skip:n,Take:r,Week:u};f.loading(!0);t.get("/Calendar/SearchWeek",{params:e}).then(function(n){i.getAll=n.data.result;setTimeout(function(){f.setColspan()},100);f.loading(!1)})}function l(n,r){var u={Count:n,Search:r};f.loading(!0);t.get("/Calendar/SearchName",{params:u}).then(function(n){for(var t=0;t<n.data.result.length;t++)i.getAll.push(n.data.result[t]);f.loading(!1);setTimeout(function(){f.setColspan();f.getColor()},100)})}function g(n,r,u){f.loading(!0);var e={Skip:n,Take:r,Date:u};t.get("/Calendar/SearchDate",{params:e}).then(function(n){i.getAll=n.data.result;setTimeout(function(){f.setColspan()},100);f.loading(!1)})}var a=this,h,c;i.getAll=[];i.users=[];a.title="calendar_view_ctrl";i.count=15;h=(new signalR.HubConnectionBuilder).withUrl("/mesHub").build();v();i.edit_cc=function(n){h.invoke("SendMessage","1","table","edit "+n).catch(function(n){return console.error(n.toString())})};c=0;i.$watch("week",function(){if(c++,c>=2){var n=u("date")(i.week,"yyyy-ww");d(0,0,n);e(function(){f.getColor()},1e3)}});i.$watch("searchDate",function(){if(i.load==1){var n=i.searchDate;g(0,0,n);f.getColor()}i.load!=1&&(i.load=1)});i.$watch("search",function(){i.count=15;var n=i.search;i.getAll=[];l(i.count,n);f.getColor()});i.hoverIn=function(){this.hoverEdit="show"};i.formatDate=function(n){return f.formatDate(n,1)};i.onChangeWeek=function(){};i.hoverOut=function(){this.hoverEdit="hide"};i.showEdit=function(){};i.createCalendar=function(){var t="",n;$(".name-admin-create").magicsearch({dataSource:i.users,fields:["name","emailAddress"],id:"id",format:"%name% - %emailAddress%",multiple:!0,multiField:"name",multiStyle:{space:5,width:80},success:function(n,i){var r=n.attr("data-id");$("#IdAdmins").val(r);t+=r.split(",").length==1?i.name:","+i.name;$("#Admin").val(t)},afterDelete:function(n,i){var r=n.attr("data-id");$("#IdAdmins").val(r);t=t.replace(i.name+",","");r.split(",").length==1&&(t=t.replace(i.name,""));$("#Admin").val(t)}});n="";$(".name-admin-user").magicsearch({dataSource:i.users,fields:["name","emailAddress"],id:"id",format:"%name% - %emailAddress%",multiple:!0,multiField:"name",multiStyle:{space:5,width:80},success:function(t,i){var r=t.attr("data-id");$("#IdUsers").val(r);n+=r.split(",").length==1?i.name:","+i.name;$("#Users").val(n)},afterDelete:function(t,i){var r=t.attr("data-id");$("#IdUsers").val(r);n=n.replace(i.name+",","");r.split(",").length==1&&(n=n.replace(i.name,""));$("#Users").val(n)}})};i.edit_caladarView=function(n){var r="/Calendar/EditCalendarViewModal?id="+n;t.get(r).then(function(t){var e=$("#editCalendarView div.modal-body").html(t.data),r,f,u;s(e)(i);$("textarea").froalaEditor({heightMin:250});r="";f=[];f=i.users;$(".name-admin1").magicsearch({dataSource:f,fields:["name","emailAddress"],id:"id",format:"%name% - %emailAddress%",multiple:!0,multiField:"name",multiStyle:{space:5,width:80},success:function(n,t){var i=n.attr("data-id");$(".id-admin1").val(i);r+=i.split(",").length==1?t.name:","+t.name;$(".admin1").val(r)},afterDelete:function(n,t){var i=n.attr("data-id");$(".id-admin1").val(i);r=r.replace(t.name+",","");$(".admin1").val(r)}});u="";$(".name-admin2").magicsearch({dataSource:f,fields:["name","emailAddress"],id:"id",format:"%name% - %emailAddress%",multiple:!0,multiField:"name",multiStyle:{space:5,width:80},success:function(n,t){var i=n.attr("data-id");u+=i.split(",").length==1?t.name:","+t.name;$(".edit-user1").val(u);$(".id-edit-user1").val(i)},afterDelete:function(n,t){var i=n.attr("data-id");u=u.replace(t.name+",","");$(".edit-user1").val(u);$(".id-edit-user1").val(i)}});w(n)})};i.uCanTrust=function(n){return o.trustAsHtml(n)};i.delete_item=function(n,r){var u="/Calendar/Delete?id="+n;t.get(u).then(function(){i.getAll.splice(r,1)})};i.showBtns=function(){};i.createcalendar=function(){alert("ok")}}app.controller("ctrl",n);n.$inject=["$location","$http","$scope","$window","$filter","factory","$timeout","$sce","$compile"]})();